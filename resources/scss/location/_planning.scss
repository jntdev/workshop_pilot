@use '../base/colors' as *;
@use '../base/typos' as *;
@use '../base/rules' as *;

// Palette de 30 couleurs (réutilisée depuis _index-page.scss)
$reservation-colors: (
  0: #3b82f6,  1: #ef4444,  2: #22c55e,  3: #f59e0b,  4: #8b5cf6,
  5: #ec4899,  6: #14b8a6,  7: #f97316,  8: #6366f1,  9: #84cc16,
  10: #8fb8f9, 11: #f59090, 12: #7dda9b, 13: #f9c56b, 14: #b99cf9,
  15: #f3a0c4, 16: #6dd4c8, 17: #fba76f, 18: #a1a3f7, 19: #b5de6d,
  20: #b8d4fb, 21: #f9b8b8, 22: #a8e8be, 23: #fbda9e, 24: #d4c4fb,
  25: #f7c5da, 26: #9de5dd, 27: #fcc9a3, 28: #c5c6f9, 29: #d1e9a0,
);

// Panneau planning intégré (dans le side panel)
.planning-panel {
  width: 100%;
  height: 100%;
  background: $color-bg-light;
  display: flex;
  flex-direction: column;
  overflow: hidden;

  &__header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-bottom: 1px solid $color-border-light;
    background: $color-bg-white;
  }

  &__close {
    width: 32px;
    height: 32px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: transparent;
    color: $color-neutral-medium;
    border: none;
    border-radius: 4px;
    cursor: pointer;

    &:hover {
      background: $color-neutral-light;
      color: $color-neutral-dark;
    }
  }

  &__title {
    flex: 1;
    font-size: 1.125rem;
    font-weight: 600;
    color: $color-neutral-dark;
    margin: 0;
    text-transform: capitalize;
  }

  &__summary {
    font-size: 0.8125rem;
    color: $color-neutral-medium;
    white-space: nowrap;
  }

  &__nav {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.75rem 1rem;
    background: $color-bg-white;
    border-bottom: 1px solid $color-border-light;
  }

  &__nav-btn {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    border-radius: 4px;
    border: 1px solid $color-border-medium;
    background: $color-bg-white;
    cursor: pointer;
    transition: background 0.15s ease;

    &:hover:not(:disabled) {
      background: $color-neutral-light;
    }

    &:disabled {
      opacity: 0.5;
      cursor: default;
    }

    &--today {
      background: $color-primary-blue;
      color: $color-bg-white;
      border-color: $color-primary-blue;

      &:hover:not(:disabled) {
        background: darken($color-primary-blue, 8%);
      }
    }
  }

  &__date-input {
    padding: 0.375rem 0.5rem;
    font-size: 0.75rem;
    border: 1px solid $color-border-medium;
    border-radius: 4px;
    margin-left: auto;
  }

  &__content {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    align-content: start;
  }
}

// Page planning standalone (conservée pour compatibilité)
.planning {
  padding: 1.5rem;
  max-width: 1400px;
  margin: 0 auto;

  &__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid $color-border-light;
    position: sticky;
    top: 0;
    background: $color-bg-white;
    z-index: 10;
  }

  &__back {
    color: $color-primary-blue;
    font-size: 0.875rem;
    text-decoration: none;
    font-weight: 500;

    &:hover {
      text-decoration: underline;
    }
  }

  &__nav {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  &__nav-btn {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 6px;
    border: 1px solid $color-border-medium;
    background: $color-bg-white;
    cursor: pointer;
    transition: background 0.15s ease;

    &:hover:not(:disabled) {
      background: $color-neutral-light;
    }

    &:disabled {
      opacity: 0.5;
      cursor: default;
    }

    &--today {
      background: $color-primary-blue;
      color: $color-bg-white;
      border-color: $color-primary-blue;

      &:hover:not(:disabled) {
        background: darken($color-primary-blue, 8%);
      }
    }
  }

  &__date-input {
    padding: 0.5rem;
    font-size: 0.875rem;
    border: 1px solid $color-border-medium;
    border-radius: 6px;
  }

  &__summary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: $color-neutral-medium;
  }

  &__summary-separator {
    color: $color-border-medium;
  }

  &__title {
    font-size: 1.5rem;
    font-weight: 600;
    color: $color-neutral-dark;
    margin: 0 0 1.5rem;
    text-transform: capitalize;
  }

  &__columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;

    @media (max-width: 900px) {
      grid-template-columns: 1fr;
    }
  }
}

.planning-column {
  &__title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: $color-neutral-dark;
    margin: 0 0 0.75rem;
    padding-bottom: 0.375rem;
    border-bottom: 2px solid $color-neutral-dark;
  }

  &__count {
    background: $color-neutral-light;
    color: $color-neutral-medium;
    font-size: 0.625rem;
    font-weight: 600;
    padding: 0.125rem 0.375rem;
    border-radius: 999px;
  }

  &__empty {
    background: $color-bg-white;
    border: 1px dashed $color-border-medium;
    border-radius: 6px;
    padding: 1.5rem;
    text-align: center;
    color: $color-neutral-medium;
    font-size: 0.8125rem;
  }
}

.planning-section {
  margin-bottom: 1rem;

  &__title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.6875rem;
    font-weight: 600;
    color: $color-neutral-medium;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0 0 0.5rem;
  }

  &__cards {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
}

.planning-card {
  background: $color-bg-white;
  border: 1px solid $color-border-light;
  border-radius: 8px;
  padding: 0.75rem;
  border-left: 4px solid $color-primary-blue;
  transition: box-shadow 0.15s ease;
  cursor: pointer;

  &:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border-color: $color-border-medium;
  }

  // Couleurs via data-attribute
  @each $index, $color in $reservation-colors {
    &[data-color="#{$index}"] {
      border-left-color: $color;
    }
  }

  &__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
  }

  &__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
  }

  &__badge {
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;

    &--delivery {
      background: #dbeafe;
      color: #1d4ed8;
    }

    &--pickup {
      background: #f3e8ff;
      color: #7c3aed;
    }

    &--warning {
      background: #fef3c7;
      color: #d97706;
    }

    &--danger {
      background: #fee2e2;
      color: #dc2626;
    }
  }

  &__status {
    font-size: 0.75rem;
    font-weight: 500;
    color: $color-neutral-medium;

    &[data-status="reserve"] {
      color: #3b82f6;
    }

    &[data-status="en_attente_acompte"] {
      color: #f59e0b;
    }

    &[data-status="en_cours"] {
      color: #22c55e;
    }

    &[data-status="paye"] {
      color: #10b981;
    }
  }

  &__client {
    margin-bottom: 0.75rem;
  }

  &__client-name {
    font-size: 1rem;
    font-weight: 600;
    color: $color-neutral-dark;
    display: block;
  }

  &__client-phone {
    font-size: 0.875rem;
    color: $color-primary-blue;
    text-decoration: none;

    &:hover {
      text-decoration: underline;
    }
  }

  &__bikes {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin-bottom: 0.75rem;
  }

  &__bike {
    font-size: 0.75rem;
    background: $color-bg-light;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    color: $color-neutral-dark;
  }

  &__bike-qty {
    font-weight: 600;
    margin-right: 0.25rem;
  }

  &__logistics {
    background: $color-bg-light;
    border-radius: 6px;
    padding: 0.75rem;
    margin-bottom: 0.75rem;
    font-size: 0.8125rem;
  }

  &__address {
    font-weight: 500;
    color: $color-neutral-dark;
    margin-bottom: 0.25rem;
  }

  &__slot,
  &__contact {
    color: $color-neutral-medium;
  }

  &__comments,
  &__comment {
    font-size: 0.8125rem;
    color: $color-neutral-medium;
    font-style: italic;
    margin-top: 0.5rem;
    padding: 0.5rem;
    background: $color-bg-light;
    border-radius: 4px;
    border-left: 2px solid $color-border-medium;
    white-space: pre-line;
  }

  &__actions {
    display: flex;
    gap: 0.5rem;
  }

  &__action {
    font-size: 0.75rem;
    font-weight: 500;
    color: $color-primary-blue;
    text-decoration: none;
    padding: 0.375rem 0.75rem;
    border: 1px solid $color-primary-blue;
    border-radius: 4px;
    transition: background 0.15s ease;

    &:hover {
      background: rgba($color-primary-blue, 0.08);
    }
  }
}
